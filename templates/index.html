<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>RDAP WHOIS</title>
  <style>
    :root { --border:#ddd; --muted:#666; --bg:#f6f8fa; }
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; margin: 2rem; }
    form { display:flex; gap:.5rem; margin-bottom:1rem; }
    input[type=text]{ flex:1; padding:.6rem; font-size:1rem; }
    button{ padding:.6rem 1rem; font-size:1rem; cursor:pointer; }
    .card{ border:1px solid var(--border); border-radius:8px; padding:1rem; }
    .muted{ color:var(--muted); font-size:.9rem; }
    code { background:var(--bg); padding:.15rem .35rem; border-radius:4px; }
    .mono { font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace; white-space: normal; }
    .oneline { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .kv { display:grid; grid-template-columns: 220px 1fr; gap:.35rem .75rem; margin:.5rem 0; }
    .kv div:nth-child(odd){ color:#555; }
    hr { border:0; border-top:1px solid #eee; margin:1rem 0; }
    a { text-decoration: none; }
    a:hover { text-decoration: underline; }
    .section{ margin:1rem 0; }
    details { border:1px solid var(--border); border-radius:8px; padding:.6rem .8rem; background: #fff; }
    details>summary{ cursor:pointer; font-weight:600; }
    .pill{ display:inline-block; border:1px solid var(--border); border-radius:999px; padding:.05rem .5rem; font-size:.85rem; margin:.1rem .25rem 0 0; }
    .stack{ display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; }
    .copy{ font-size:.85rem; border:1px solid var(--border); border-radius:6px; padding:.2rem .5rem; background:#fff; cursor:pointer; }
    .small{ font-size:.95rem; }
    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:.6rem .8rem; }
    @media (max-width:800px){ .kv{grid-template-columns: 1fr}; .grid2{grid-template-columns:1fr} }
    .kvt{ display:grid; grid-template-columns: 180px 1fr; gap:.25rem .6rem; }
    .tag{font-size:.8rem; background:var(--bg); border:1px solid var(--border); border-radius:4px; padding:.05rem .35rem; }
    .notice{ background:#fffdf5; border:1px solid #f3e5ab; }
  </style>
</head>
<body>
  <h1>RDAP WHOIS</h1>
  <p class="muted">Podaj <b>domenę</b>, <b>IP</b> lub <b>AS</b> (np. <code>example.com</code>, <code>1.1.1.1</code>, <code>AS15169</code>).</p>

  <form method="get" action="/">
    <input type="text" name="q" placeholder="example.com" value="{{ q|e }}" autofocus>
    <button type="submit">Szukaj</button>
  </form>

  {% if error %}
    <div class="card" style="border-color:#f00;color:#900;"><b>{{ error }}</b></div>
  {% endif %}

  {% if result %}
    {% set ocn = result.objectClassName %}

    {% if ocn == "domain" %}
      <div class="card">

        {# ===== Podsumowanie do kopiowania (hidden) ===== #}
        {% set L = [] %}
        {% macro add(label, val) -%}{% if val %}{% set _ = L.append(label ~ ": " ~ val) %}{% endif %}{%- endmacro %}

        {{ add("Domain Name", result.domainName) }}
        {{ add("Updated Date", result.updatedDate) }}
        {{ add("Creation Date", result.creationDate) }}
        {{ add("Registry Expiry Date", result.expiryDate) }}
        {{ add("Registrar", result.registrar) }}
        {{ add("Registrar IANA ID", result.registrarIanaId) }}
        {{ add("Registrar URL", result.registrarUrl) }}
        {{ add("DNSSEC", result.dnssec) }}
        {{ add("Registrar Abuse Contact Email", result.abuseContact.email) }}
        {{ add("Registrar Abuse Contact Phone", result.abuseContact.phone) }}

        {% if result.statuses %}
          {% for st in result.statuses %}
            {% set line = (st.raw ~ " — https://icann.org/epp#" ~ st.epp) %}
            {{ add("Domain Status", line) }}
          {% endfor %}
        {% endif %}

        {% if result.nameServers %}
          {% for ns in result.nameServers %}
            {{ add("Name Server", ns) }}
          {% endfor %}
        {% endif %}

        <pre id="copy-summary" style="position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden;">{{ L|join("\n") }}</pre>
        {# ===== /Podsumowanie do kopiowania ===== #}

        <div class="kv">
          <div>Domain Name</div>
          <div class="mono stack">
            {{ result.domainName }}
            <button class="copy" data-copy-target="#copy-summary" title="Kopiuj całe podsumowanie">Kopiuj</button>
          </div>
          {% if result.registryDomainId %}<div>Registry Domain ID</div><div class="mono">{{ result.registryDomainId }}</div>{% endif %}
          {% if result.updatedDate %}<div>Updated Date</div><div class="mono">{{ result.updatedDate }}</div>{% endif %}
          {% if result.creationDate %}<div>Creation Date</div><div class="mono">{{ result.creationDate }}</div>{% endif %}
          {% if result.expiryDate %}<div>Registry Expiry Date</div><div class="mono">{{ result.expiryDate }}</div>{% endif %}
          {% if result.registrar %}<div>Registrar</div><div class="mono">{{ result.registrar }}</div>{% endif %}
          {% if result.registrarIanaId %}<div>Registrar IANA ID</div><div class="mono">{{ result.registrarIanaId }}</div>{% endif %}
          {% if result.registrarUrl %}<div>Registrar URL</div><div class="mono"><a href="{{ result.registrarUrl }}" target="_blank" rel="noopener">{{ result.registrarUrl }}</a></div>{% endif %}
          <div>DNSSEC</div><div class="mono">{{ result.dnssec }}</div>
          {% if result.abuseContact.email %}<div>Registrar Abuse Contact Email</div><div class="mono"><a href="mailto:{{ result.abuseContact.email }}">{{ result.abuseContact.email }}</a></div>{% endif %}
          {% if result.abuseContact.phone %}<div>Registrar Abuse Contact Phone</div><div class="mono">{{ result.abuseContact.phone }}</div>{% endif %}

          {% if result.statuses and result.statuses|length %}
            {% for st in result.statuses %}
              <div>Domain Status</div>
              <div class="mono oneline">{{ st.raw }} — <a href="https://icann.org/epp#{{ st.epp }}" target="_blank" rel="noopener">https://icann.org/epp#{{ st.epp }}</a></div>
            {% endfor %}
          {% endif %}

          {% if result.nameServers and result.nameServers|length %}
            {% for ns in result.nameServers %}
              <div>Name Server</div><div class="mono">{{ ns }}</div>
            {% endfor %}
          {% endif %}
        </div>

        <div class="section">
          <details>
            <summary>Pokaż surowe RDAP (JSON)</summary>
            <pre class="mono" style="white-space:pre-wrap;">{{ (rdap_raw if rdap_raw is defined and rdap_raw else result) | tojson(indent=2) }}</pre>
          </details>
        </div>
      </div>

    {% elif ocn == "ip network" %}
      <div class="card">
        <div class="kv">
          {% if result.handle %}<div>Network</div><div class="mono">{{ result.handle }}</div>{% endif %}
          {% if result.cidr %}<div>CIDR</div><div class="mono">{{ result.cidr }}</div>{% endif %}
          {% if result.range %}<div>Range</div><div class="mono">{{ result.range }}</div>{% endif %}
          {% if result.ipVersion %}<div>Version</div><div class="mono">{{ result.ipVersion }}</div>{% endif %}
          {% if result.name %}<div>Name</div><div class="mono">{{ result.name }}</div>{% endif %}
          {% if result.type %}<div>Type</div><div class="mono">{{ result.type }}</div>{% endif %}
          {% if result.country %}<div>Country</div><div class="mono">{{ result.country }}</div>{% endif %}
          {% if result.org %}<div>Org</div><div class="mono">{{ result.org }}</div>{% endif %}
          {% if result.abuseContact.email %}<div>Abuse Email</div><div class="mono"><a href="mailto:{{ result.abuseContact.email }}">{{ result.abuseContact.email }}</a></div>{% endif %}
          {% if result.abuseContact.phone %}<div>Abuse Phone</div><div class="mono">{{ result.abuseContact.phone }}</div>{% endif %}
        </div>
        <div class="section">
          <details>
            <summary>Pokaż surowe RDAP (JSON)</summary>
            <pre class="mono" style="white-space:pre-wrap;">{{ (rdap_raw if rdap_raw is defined and rdap_raw else result) | tojson(indent=2) }}</pre>
          </details>
        </div>
      </div>

    {% elif ocn == "autnum" %}
      <div class="card">
        <div class="kv">
          {% if result.asNumber %}<div>ASNumber</div><div class="mono">{{ result.asNumber }}</div>{% endif %}
          {% if result.range %}<div>Range</div><div class="mono">{{ result.range }}</div>{% endif %}
          {% if result.name %}<div>Name</div><div class="mono">{{ result.name }}</div>{% endif %}
          {% if result.type %}<div>Type</div><div class="mono">{{ result.type }}</div>{% endif %}
          {% if result.country %}<div>Country</div><div class="mono">{{ result.country }}</div>{% endif %}
          {% if result.org %}<div>Org</div><div class="mono">{{ result.org }}</div>{% endif %}
          {% if result.abuseContact.email %}<div>Abuse Email</div><div class="mono"><a href="mailto:{{ result.abuseContact.email }}">{{ result.abuseContact.email }}</a></div>{% endif %}
          {% if result.abuseContact.phone %}<div>Abuse Phone</div><div class="mono">{{ result.abuseContact.phone }}</div>{% endif %}
        </div>
        <div class="section">
          <details>
            <summary>Pokaż surowe RDAP (JSON)</summary>
            <pre class="mono" style="white-space:pre-wrap;">{{ (rdap_raw if rdap_raw is defined and rdap_raw else result) | tojson(indent=2) }}</pre>
          </details>
        </div>
      </div>

    {% else %}
      <div class="card mono">{{ (rdap_raw if rdap_raw is defined and rdap_raw else result) | tojson(indent=2) }}</div>
    {% endif %}
  {% endif %}

  <script>
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('.copy');
      if(!btn) return;

      const explicit = btn.getAttribute('data-copy');
      const targetSel = btn.getAttribute('data-copy-target');
      let text = explicit || '';

      if(!text && targetSel){
        const el = document.querySelector(targetSel);
        if(el) text = el.innerText || el.textContent || '';
      }
      if(!text) return;

      navigator.clipboard.writeText(text).then(()=>{
        const old = btn.textContent;
        btn.textContent = 'Skopiowano';
        setTimeout(()=>{ btn.textContent = old; }, 1200);
      });
    });
  </script>
</body>
</html>
